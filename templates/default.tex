\documentclass[a4paper,11pt]{article}

% Packages de base
\usepackage{fontspec}
\usepackage{geometry}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{booktabs}
\usepackage{listings}

% Configuration de la page
\geometry{
  a4paper,
  margin=2.5cm,
  includehead,
  includefoot
}

% Configuration des liens
\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  filecolor=magenta,      
  urlcolor=cyan,
  pdftitle={$title$},
  pdfauthor={$author$}
}

% Configuration des en-têtes et pieds de page
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{$title$}
\fancyhead[R]{$date$}
\fancyfoot[C]{Page \thepage}

% Configuration des styles de titres
\titleformat{\section}{\Large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\large\bfseries}{\thesubsection}{1em}{}
\titleformat{\subsubsection}{\normalsize\bfseries}{\thesubsubsection}{1em}{}

% Configuration des styles de code
\definecolor{codebackground}{rgb}{0.95,0.95,0.95}
\definecolor{codeborder}{rgb}{0.8,0.8,0.8}

\lstset{
  basicstyle=\ttfamily\small,
  backgroundcolor=\color{codebackground},
  frame=single,
  rulecolor=\color{codeborder},
  numbers=left,
  numberstyle=\tiny\color{gray},
  numbersep=5pt,
  breaklines=true,
  breakatwhitespace=true,
  showspaces=false,
  showstringspaces=false,
  captionpos=b
}

% Métadonnées
$if(title)$
\title{$title$}
$endif$
$if(author)$
\author{$author$}
$endif$
$if(date)$
\date{$date$}
$endif$

% Corps du document
\begin{document}

% Page de titre
$if(title)$
\maketitle
$endif$

% Table des matières
$if(toc)$
\tableofcontents
\newpage
$endif$

% Contenu
$body$

\end{document}